{{ 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css' | stylesheet_tag }}

{% style %}
  .cookie-carousel {
    background-color: white;
    padding-top: 60px;
    display: flex;
    justify-content: center;
    border-bottom: 1px solid #eee;
    overflow: hidden;
  }

  .carousel-container {
    width: 100%;
    padding: 0 20px;
    position: relative;
  }

  .carousel-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }

  .carousel-title {
    color: {{ section.settings.title_color }};
    font-size: 36px;
    line-height: 36px;
    font-family: 'Koulen', cursive;
    font-weight: 400;
  }

  .carousel-arrows {
    display: flex;
    gap: 12px;
  }

  .arrow-btn {
    border: none;
    background: none;
    padding: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    cursor: pointer;
    color: #333;
    transition: color 0.2s ease;
  }

  .arrow-btn:hover {
    color: {{ section.settings.title_color }};
  }

  .arrow-btn:disabled {
    color: #ccc;
    cursor: not-allowed;
  }

  .cookie-row {
    position: relative;
    width: 100%;
    overflow: hidden;
  }

  .cookie-scroll-container {
    display: flex;
    gap: 22px;
    transition: transform 0.5s ease;
    padding: 20px 0;
  }

  .cookie-img-container {
    flex: 0 0 100px;
    width: 100px;
    height: 100px;
    overflow: hidden;
  }

  .cookie-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  @media (max-width: 768px) {
    .carousel-header {
      gap: 20px;
    }

    .carousel-title {
      font-size: 28px;
      line-height: 28px;
    }

    .carousel-arrows {
      gap: 8px;
    }

    .cookie-img-container {
      flex: 0 0 80px;
      width: 80px;
      height: 80px;
    }
  }
{% endstyle %}

<section class="cookie-carousel">
  <div class="carousel-container">
    <div class="carousel-header">
      <div class="carousel-title">
        {{ section.settings.title }}
      </div>
      <div class="carousel-arrows">
        <button class="arrow-btn js-scroll-left" aria-label="Scroll left">
          <i class="fas fa-chevron-left"></i>
        </button>
        <button class="arrow-btn js-scroll-right" aria-label="Scroll right">
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    </div>
    
    <div class="cookie-row">
      <div class="cookie-scroll-container" data-carousel>
        {%- assign total_images = 100 -%}
        {%- assign uploaded_images = section.blocks | where: "type", "cookie_image" -%}
        {%- assign uploaded_count = 0 -%}
        {%- for block in uploaded_images -%}
          {%- if block.settings.image != blank -%}
            {%- assign uploaded_count = uploaded_count | plus: 1 -%}
          {%- endif -%}
        {%- endfor -%}
        
        {%- if uploaded_count > 0 -%}
          {%- for i in (1..total_images) -%}
            {%- assign index = i | modulo: uploaded_count | minus: 1 -%}
            {%- assign current_block = uploaded_images[index] -%}
            {%- if current_block.settings.image != blank -%}
              <div class="cookie-img-container">
                <img 
                  src="{{ current_block.settings.image | img_url: '200x' }}"
                  alt="{{ current_block.settings.image.alt | escape }}"
                  loading="lazy"
                  class="cookie-img"
                  width="100"
                  height="100">
              </div>
            {%- endif -%}
          {%- endfor -%}
        {%- endif -%}
      </div>
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const carousel = document.querySelector('[data-carousel]');
    const scrollLeft = document.querySelector('.js-scroll-left');
    const scrollRight = document.querySelector('.js-scroll-right');
    let currentIndex = 0;
    const itemWidth = 122; // 100px image + 22px gap
    
    function updateCarouselPosition() {
      carousel.style.transform = `translateX(${-currentIndex * itemWidth}px)`;
      
      // Disable/enable buttons based on position
      scrollLeft.disabled = currentIndex === 0;
      scrollRight.disabled = currentIndex >= carousel.children.length - 8;
    }

    if (scrollLeft && scrollRight && carousel) {
      // Initially disable left button
      scrollLeft.disabled = true;

      scrollLeft.addEventListener('click', () => {
        if (currentIndex > 0) {
          currentIndex--;
          updateCarouselPosition();
        }
      });
      
      scrollRight.addEventListener('click', () => {
        if (currentIndex < carousel.children.length - 8) {
          currentIndex++;
          updateCarouselPosition();
        }
      });
    }
  });
</script>

{% schema %}
{
  "name": "Cookie Carousel",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "LOVED BY AMERICA FOR 25+ YEARS"
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Title Color",
      "default": "#D53E6C"
    }
  ],
  "blocks": [
    {
      "type": "cookie_image",
      "name": "Cookie Image",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Cookie Image",
          "info": "100 x 100px recommended"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Cookie Carousel",
      "settings": {
        "title": "LOVED BY AMERICA FOR 25+ YEARS",
        "title_color": "#D53E6C"
      }
    }
  ]
}
{% endschema %} 